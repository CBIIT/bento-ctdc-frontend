type arm {
  arm_id: String
  arm_title: String
  arm_target: String
  arm_drug: String
  pubmed_id: String
  dbgap_accession_number: String
  assignment_reports: [assignment_report] @relation(name:"of_arm", direction:IN)
  cases: [case] @relation(name:"of_arm", direction:IN)
  files: [file] @relation(name:"of_arm", direction:IN)
  disease_eligibility_criterions: [disease_eligibility_criterion] @relation(name:"of_arm", direction:IN)
  drug_eligibility_criterions: [drug_eligibility_criterion] @relation(name:"of_arm", direction:IN)
  clinical_trial: clinical_trial @relation(name:"of_trial", direction:OUT)
}

type assignment_report {
  assignment_report_id: String
  step_at_assignment: Int
  assignment_logic: String
  assignment_outcome: String
  treatment_outcome: String
  specimen: specimen @relation(name:"of_specimen", direction:OUT)
  variant_report: variant_report @relation(name:"of_variant_report", direction:OUT)
  arms: [arm] @relation(name:"of_arm", direction:OUT)
}

type case {
  case_id: String
  gender: String
  race: String
  ethnicity: String
  patient_status: String
  current_step: Int
  disease: String
  ctep_category: String
  ctep_subcategory: String
  meddra_code: String
  prior_drugs: String
  extent_of_disease: String
  ecog_performance_status: Int
  specimens: [specimen] @relation(name:"of_case", direction:IN)
  arms: [arm] @relation(name:"of_arm", direction:OUT)
  metastatic_sites: [metastatic_site] @relation(name:"met_site_of", direction:IN)
}

type clinical_trial {
  clinical_trial_id: String
  clinical_trial_short_name: String
  clinical_trial_description: String
  clinical_trial_designation: String
  clinical_trial_long_name: String
  clinical_trial_type: String
  lead_organization: String
  principal_investigators: String
  dbgap_accession_number: String
  arms: [arm] @relation(name:"of_trial", direction:IN)
}

type copy_number_variant {
  variant_id: String
  external_variant_id: String
  gene: String
  chromosome: String
  oncomine_variant_class: String
  tumor_suppressor: Boolean
  variant_reports: [variant_report] @relation(name:"copy_number_variant_of", direction:OUT)
}

type copy_number_variant_of {
  copy_number: Float
  copy_number_ci_5: Float
  copy_number_ci_95: Float
}

type delins_variant {
  variant_id: String
  external_variant_id: String
  gene: String
  chromosome: String
  exon: Int
  position: Int
  reference: String
  alternative: String
  transcript_id: String
  transcript_hgvs: String
  genomic_hgvs: String
  oncomine_variant_class: String
  variant_classification: String
  amino_acid_change: String
  variant_reports: [variant_report] @relation(name:"delins_variant_of", direction:OUT)
}

type delins_variant_of {
  allele_frequency: Float
}

type disease_eligibility_criterion {
  disease_eligibility_criterion_id: String
  criterion_type: String
  ctep_category: String
  ctep_subcategory: String
  ctep_short_name: String
  meddra_code: String
  arms: [arm] @relation(name:"of_arm", direction:OUT)
}

type drug_eligibility_criterion {
  drug_eligibility_criterion_id: String
  criterion_type: String
  drug_name: String
  arms: [arm] @relation(name:"of_arm", direction:OUT)
}

type file {
  file_description: String
  file_format: String
  file_location: String
  file_name: String
  file_size: Float
  file_status: String
  file_type: String
  md5sum: String
  uuid: String
  sequencing_assay: sequencing_assay @relation(name:"of_sequencing_assay", direction:OUT)
  arms: [arm] @relation(name:"of_arm", direction:OUT)
}

type gene_fusion_variant {
  variant_id: String
  external_variant_id: String
  gene1: String
  gene2: String
  oncomine_variant_class: String
  variant_reports: [variant_report] @relation(name:"gene_fusion_variant_of", direction:OUT)
}

type gene_fusion_variant_of {
  gene1_read_count: Int
  gene2_read_count: Int
}

type ihc_assay_report {
  ihc_assay_id: String
  ihc_test_gene: String
  ihc_test_result: String
  specimen: specimen @relation(name:"of_specimen", direction:OUT)
}

type indel_variant {
  variant_id: String
  external_variant_id: String
  gene: String
  chromosome: String
  exon: Int
  position: Int
  reference: String
  alternative: String
  transcript_id: String
  transcript_hgvs: String
  genomic_hgvs: String
  oncomine_variant_class: String
  variant_classification: String
  amino_acid_change: String
  variant_reports: [variant_report] @relation(name:"indel_variant_of", direction:OUT)
}

type indel_variant_of {
  allele_frequency: Float
}

type metastatic_site {
  met_site_id: String
  metastatic_site_name: String
  cases: [case] @relation(name:"met_site_of", direction:OUT)
}

type nucleic_acid {
  aliquot_id: String
  nucleic_acid_concentration: Float
  nucleic_acid_volume: Float
  nucleic_acid_type: String
  specimen: specimen @relation(name:"of_specimen", direction:OUT)
  sequencing_assays: [sequencing_assay] @relation(name:"of_nucleic_acid", direction:IN)
}

type sequencing_assay {
  qc_result: String
  experimental_method: String
  platform: String
  nucleic_acid: nucleic_acid @relation(name:"of_nucleic_acid", direction:OUT)
  files: [file] @relation(name:"of_sequencing_assay", direction:IN)
  variant_reports: [variant_report] @relation(name:"of_sequencing_assay", direction:IN)
}

type snv_variant {
  variant_id: String
  external_variant_id: String
  gene: String
  chromosome: String
  exon: Int
  position: Int
  reference: String
  alternative: String
  transcript_id: String
  transcript_hgvs: String
  genomic_hgvs: String
  oncomine_variant_class: String
  variant_classification: String
  amino_acid_change: String
  variant_reports: [variant_report] @relation(name:"snv_variant_of", direction:OUT)
}

type snv_variant_of {
  allele_frequency: Float
}

type specimen {
  specimen_id: String
  specimen_type: String
  case: case @relation(name:"of_case", direction:OUT)
  ihc_assay_reports: [ihc_assay_report] @relation(name:"of_specimen", direction:IN)
  nucleic_acids: [nucleic_acid] @relation(name:"of_specimen", direction:IN)
  assignment_reports: [assignment_report] @relation(name:"of_specimen", direction:IN)
}

type variant_report {
  variant_report_id: String
  mapd: Float
  cellularity: Float
  torrent_variant_caller_version: String
  reference_genome: String
  sequencing_assay: sequencing_assay @relation(name:"of_sequencing_assay", direction:OUT)
  snv_variants: [snv_variant] @relation(name:"snv_variant_of", direction:IN)
  delins_variants: [delins_variant] @relation(name:"delins_variant_of", direction:IN)
  indel_variants: [indel_variant] @relation(name:"indel_variant_of", direction:IN)
  copy_number_variants: [copy_number_variant] @relation(name:"copy_number_variant_of", direction:IN)
  gene_fusion_variants: [gene_fusion_variant] @relation(name:"gene_fusion_variant_of", direction:IN)
  assignment_reports: [assignment_report] @relation(name:"of_variant_report", direction:IN)
}

schema {
  query: QueryType
}

type ArmInfo {
  arms: String
  caseSize: Int
}

type TrialArms {
  trials: String
  caseSize: Int
  arms: [ArmInfo]
}

type FileUuid{
  uuid: String
}

type CaseOverview{
  case_id: String
  clinical_trial_code: String
  arm_id: String
  arm_drug: String
  disease: String
  gender: String
  race: String
  arm_target: String
  ethnicity: String
  clinical_trial_id: String
  pubmed_id: String
  trial_arm: String
  file_types: [String]
  file_formats: [String]
  files: [FileUuid]
}

type GroupCount{
  group: String
  count: Int
}

type SearchResult{
  numberOfTrials: Int
  numberOfCases: Int
  numberOfFiles: Int
  fileIds: [String]
  caseIds: [String]
  firstPage: [CaseOverview]
}

type FileOverview{
  uuid: String,
  file_name: String,
  file_description: String,
  file_format: String,
  file_size: Float,
  trial: String,
  trial_id: String,
  clinical_trial_code: String,
  arm: String,
  case_id: String,
  disease: String
}

type CaseDetail{
  case_id: String,
  clinical_trial_code: String,
  clinical_trial_id: String,
  disease: String,
  gender: String,
  race: String,
  arm_id: String,
  arm_target: String,
  arm_drug: String,
  ethnicity: String,
  files: [String]
}

type FileOfCase{
  parent: String,
  file_name: String,
  file_type: String,
  file_description: String,
  file_format: String,
  file_size: Float,
  md5sum: String
}

type FileInList{
  clinical_trial_code: String,
  case_id: String,
  arm_id: String,
  file_type: String,
  association: String,
  file_description: String,
  file_format: String,
  file_size: Float,
  uuid: String,
  md5sum: String,
  file_name: String
}

type ArmDiagnosisCount{
  arm_id: String,
  diagnoses: String
}

type ClinicalTrialInfo{
  clinical_trial_id: String,
  clinical_trial_short_name: String,
  clinical_trial_description: String,
  clinical_trial_designation: String,
  clinical_trial_long_name: String,
  clinical_trial_type: String,
  lead_organization: String,
  principal_investigators: String,
  number_of_arms: Int,
  number_of_cases: Int
}

type ClinicalTrialArm{
  arm_id: String,
  arm_target: String,
  arm_drug: String,
  pubmed_id: String,
  number_of_cases: Int
}

type FileNameAndId{
  file_name: String
  file_id: String
}

# ---Queries---

type QueryType {

  # ---Schema Version---

  schemaVersion: String @cypher(statement: """
    RETURN '0.2.2'
  """)

  # ---Numbers of nodes---

  numberOfCases: Int @cypher(statement: """
    MATCH (n:case) 
    RETURN  count (n)
  """)

  numberOfFiles: Int @cypher(statement: """
    MATCH (f:file)
    RETURN count (f)
  """)

  numberOfTrials: Int @cypher(statement: """
    MATCH (n:clinical_trial) 
    RETURN count (n)
  """)

  numberOfArms: Int @cypher(statement: """
    MATCH (n:arm) 
    RETURN count (n)
  """)

  numberOfFileTypes: Int @cypher(statement: """
    MATCH (f:file)
    RETURN COUNT(DISTINCT f.file_type)
  """)

  numberOfDiagnoses: Int @cypher(statement: """
    MATCH (c:case)
    RETURN COUNT(DISTINCT c.disease)
  """)

  trialsAndArms(case_ids: [String] = [""]): [TrialArms] @cypher(statement: """
    MATCH (c:case)
      WHERE ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids)
    OPTIONAL MATCH (c)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WITH 
      ct, 
      COUNT(DISTINCT c) AS caseSize
    OPTIONAL MATCH (c)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WITH 
      ct, caseSize,
      {
        arms: a.arm_id,
        caseSize: COUNT(DISTINCT c)
      } AS arms
    RETURN{
      trials: ct.clinical_trial_short_name,
      caseSize: caseSize,
      arms: COLLECT(arms)
    }
  """, passThrough: true)

  # ---Case Counts---

  casesCountBaseOnTrial(case_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (c:case)
      WHERE ($case_ids IS NULL OR $case_ids = [""] OR c.case_ids IN $case_ids)
    OPTIONAL MATCH (c)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    RETURN{
      group: ct.clinical_trial_id,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnTrialId(trial_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (ct:clinical_trial)
      WHERE ($trial_ids IS NULL OR $trial_ids = [""] OR ct.clinical_trial_id IN $trial_ids)
    OPTIONAL MATCH (c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct)
    RETURN{
      group: ct.clinical_trial_id,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnTrialCode(trial_codes: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (ct:clinical_trial)
      WHERE ($trial_codes IS NULL OR $trial_codes = [""] OR ct.clinical_trial_designation IN $trial_codes)
    OPTIONAL MATCH (c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct)
    RETURN{
      group: ct.clinical_trial_designation,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnPubMedID(pubmed_ids: [String] = [""], case_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (a:arm)
      WHERE ($pubmed_ids IS NULL OR $pubmed_ids = [""] OR a.pubmed_ids IN $pubmed_ids)
    OPTIONAL MATCH (c:case)-[:of_arm]->(a)
      WHERE ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids) 
    RETURN{
      group: a.pubmed_id,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnGender(genders: [String] = [""], case_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (c:case)
      WHERE ($genders IS NULL OR $genders = [""] OR c.gender IN $genders)
      AND ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids) 
    RETURN{
      group: c.gender,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnRace(races: [String] = [""], case_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (c:case)
      WHERE ($races IS NULL OR $races = [""] OR c.race IN $races)
      AND ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids) 
    RETURN{
      group: c.race,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnEthnicity(ethnicities: [String] = [""], case_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (c:case)
      WHERE ($ethnicities IS NULL OR $ethnicities = [""] OR c.ethnicity IN $ethnicities)
      AND ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids)
    RETURN{
      group: c.ethnicity,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnDiagnoses(diagnoses: [String] = [""], case_ids: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (c:case)
      WHERE ($diagnoses IS NULL OR $diagnoses = [""] OR c.disease IN $diagnoses) 
      AND ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids) 
    RETURN{
      group: c.disease,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnFileType(file_types: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (f:file)
      WHERE ($file_types IS NULL OR $file_types = [""] OR f.file_type IN $file_types)
    OPTIONAL MATCH (f)-[*]->(c:case)
    RETURN{
      group: f.file_type,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnFileFormat(file_formats: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (f:file)
      WHERE ($file_formats IS NULL OR $file_formats = [""] OR f.file_format IN $file_formats)
    OPTIONAL MATCH (f)-[*]->(c:case)
    RETURN{
      group: f.file_format,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  casesCountBaseOnTrialArm(trial_arms: [String] = [""]): [GroupCount] @cypher(statement: """
    MATCH (a:arm)
    WITH
      a, a.arm_id+'_'+ a.arm_drug AS trial_arm
    WHERE ($trial_arms IS NULL OR $trial_arms = [""] OR trial_arm IN $trial_arms) 
    OPTIONAL MATCH (c:case)-[:of_arm]->(a)
    RETURN{
      group: a.arm_id+'_'+ a.arm_drug,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)



  # ---Case Overview---

  caseOverviewPaged(case_ids: [String] = [""], order_by: String = "case_id"): [CaseOverview] @cypher(statement: """
    MATCH (c:case)
      WHERE ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids)
    OPTIONAL MATCH (f:file)-[*]->(c)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WITH
      c.case_id AS case_id,
      ct.clinical_trial_designation AS clinical_trial_code,
      a.arm_id AS arm_id,
      a.arm_drug AS arm_drug,
      c.disease AS disease,
      c.gender AS gender,
      c.race AS race,
      a.arm_target AS arm_target,
      c.ethnicity AS ethnicity,
      ct.clinical_trial_id AS clinical_trial_id,
      a.pubmed_id AS pubmed_id,
      a.arm_id+'_'+ a.arm_drug AS trial_arm,
      COLLECT(DISTINCT f.file_type) AS file_types,
      COLLECT(DISTINCT f.file_format) AS file_formats,
      COLLECT(DISTINCT {
        uuid: f.uuid
      }) AS files
    RETURN{
      case_id: case_id,
      clinical_trial_code: clinical_trial_code,
      arm_id: arm_id,
      arm_drug: arm_drug,
      disease: disease,
      gender: gender,
      race: race,
      arm_target: arm_target,
      ethnicity: ethnicity,
      clinical_trial_id: clinical_trial_id,
      pubmed_id: pubmed_id,
      trial_arm: trial_arm,
      file_types: file_types,
      file_formats: file_formats,
      files: files
    }
    ORDER BY
    CASE $order_by
      WHEN "case_id" THEN case_id
      WHEN "clinical_trial_code" THEN clinical_trial_code
      WHEN "arm_id" THEN arm_id
      WHEN "arm_drug" THEN arm_drug
      WHEN "disease" THEN disease
      WHEN "gender" THEN gender
      WHEN "race" THEN race
      WHEN "arm_target" THEN arm_target
      WHEN "ethnicity" THEN ethnicity
      WHEN "clinical_trial_id" THEN clinical_trial_id
      WHEN "pubmed_id" THEN pubmed_id
      WHEN "trial_arm" THEN trial_arm
      WHEN "file_types" THEN file_types
      WHEN "file_formats" THEN file_formats
      WHEN "files" THEN files
      ELSE case_id
    END
  """, passThrough: true)

  caseOverviewPagedDesc(case_ids: [String] = [""], order_by: String = "case_id"): [CaseOverview] @cypher(statement: """
    MATCH (c:case)
      WHERE ($case_ids IS NULL OR $case_ids = [""] OR c.case_id IN $case_ids)
    OPTIONAL MATCH (f:file)-[*]->(c)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WITH
      c.case_id AS case_id,
      ct.clinical_trial_designation AS clinical_trial_code,
      a.arm_id AS arm_id,
      a.arm_drug AS arm_drug,
      c.disease AS disease,
      c.gender AS gender,
      c.race AS race,
      a.arm_target AS arm_target,
      c.ethnicity AS ethnicity,
      ct.clinical_trial_id AS clinical_trial_id,
      a.pubmed_id AS pubmed_id,
      a.arm_id+'_'+ a.arm_drug AS trial_arm,
      COLLECT(DISTINCT f.file_type) AS file_types,
      COLLECT(DISTINCT f.file_format) AS file_formats,
      COLLECT(DISTINCT {
      uuid: f.uuid
      }) AS files
    RETURN{
      case_id: case_id,
      clinical_trial_code: clinical_trial_code,
      arm_id: arm_id,
      arm_drug: arm_drug,
      disease: disease,
      gender: gender,
      race: race,
      arm_target: arm_target,
      ethnicity: ethnicity,
      clinical_trial_id: clinical_trial_id,
      pubmed_id: pubmed_id,
      trial_arm: trial_arm,
      file_types: file_types,
      file_formats: file_formats,
      files: files
    }
    ORDER BY
      CASE $order_by
        WHEN "case_id" THEN case_id
        WHEN "clinical_trial_code" THEN clinical_trial_code
        WHEN "arm_id" THEN arm_id
        WHEN "arm_drug" THEN arm_drug
        WHEN "disease" THEN disease
        WHEN "gender" THEN gender
        WHEN "race" THEN race
        WHEN "arm_target" THEN arm_target
        WHEN "ethnicity" THEN ethnicity
        WHEN "clinical_trial_id" THEN clinical_trial_id
        WHEN "pubmed_id" THEN pubmed_id
        WHEN "trial_arm" THEN trial_arm
        WHEN "file_types" THEN file_types
        WHEN "file_formats" THEN file_formats
        WHEN "files" THEN files
        ELSE case_id
      END DESC
  """, passThrough: true)

# ---Search Subjects---

  searchSubjects(
    clinical_trial_id: [String] = [""],
    clinical_trial_designation: [String] = [""], 
    pubmed_id: [String] = [""], 
    gender: [String] = [""], 
    race: [String] = [""], 
    ethnicity: [String] = [""], 
    disease: [String] = [""], 
    file_type: [String] = [""], 
    file_format: [String] = [""], 
    trial_arm: [String] = [""], 
    first: Int = 100
  ): SearchResult @cypher(statement: """
    OPTIONAL MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
      WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
        AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
        AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
        AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
        AND ($race IS NULL OR $race = [""] OR c.race IN $race)
        AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
        AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
        AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
        AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
        AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    WITH 
      COUNT(DISTINCT ct) AS numberOfTrials,
      COUNT(DISTINCT c) AS numberOfCases,
      COUNT(DISTINCT f) AS numberOfFiles,
      COLLECT(DISTINCT f.uuid) AS fileIds,
      COLLECT(DISTINCT c.case_id) AS caseIds
    OPTIONAL MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
      WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
        AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
        AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
        AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
        AND ($race IS NULL OR $race = [""] OR c.race IN $race)
        AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
        AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
        AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
        AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
        AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    WITH
      numberOfTrials, numberOfCases, numberOfFiles, fileIds, caseIds,
      {
        case_id: c.case_id,
        clinical_trial_code: ct.clinical_trial_designation,
        arm_id: a.arm_id,
        arm_drug: a.arm_drug,
        disease: c.disease,
        gender: c.gender,
        race: c.race,
        arm_target: a.arm_target,
        ethnicity: c.ethnicity,
        clinical_trial_id: ct.clinical_trial_id,
        pubmed_id: a.pubmed_id,
        trial_arm: a.arm_id+'_'+ a.arm_drug,
        file_types: COLLECT(DISTINCT f.file_type),
        file_formats: COLLECT(DISTINCT f.file_format),
        files: COLLECT(DISTINCT {
            uuid: f.uuid
        })
      } AS firstPage
    RETURN{
      numberOfTrials: numberOfTrials,
      numberOfCases: numberOfCases,
      numberOfFiles: numberOfFiles,
      fileIds: fileIds,
      caseIds: caseIds,
      firstPage: COLLECT(DISTINCT firstPage)[0..$first]
    }
  """, passThrough: true)

# ---Filter Case Counts---

  filterCasesCountBaseOnTrialId(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: ct.clinical_trial_id,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnTrialCode(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: ct.clinical_trial_designation,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnPubMedID(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: a.pubmed_id,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnGender(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: c.gender,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnRace(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: c.race,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnEthnicity(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: c.ethnicity,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnDiagnosis(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: c.disease,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnFileType(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: f.file_type,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnFileFormat(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($trial_arm IS NULL OR $trial_arm = [""] OR a.arm_id+'_'+ a.arm_drug IN $trial_arm)
    RETURN{
      group: f.file_format,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  filterCasesCountBaseOnTrialArm(
    clinical_trial_id: [String] = [""], 
    clinical_trial_designation: [String] = [""],
    pubmed_id: [String] = [""],
    gender: [String] = [""],
    race: [String] = [""],
    ethnicity: [String] = [""],
    disease: [String] = [""],
    file_type: [String] = [""],
    file_format: [String] = [""],
    trial_arm: [String] = [""]
  ): [GroupCount] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    WHERE ($clinical_trial_id IS NULL OR $clinical_trial_id = [""] OR ct.clinical_trial_id IN $clinical_trial_id)
      AND ($clinical_trial_designation IS NULL OR $clinical_trial_designation = [""] OR ct.clinical_trial_designation IN $clinical_trial_designation)
      AND ($pubmed_id IS NULL OR $pubmed_id = [""] OR a.pubmed_id IN $pubmed_id)
      AND ($gender IS NULL OR $gender = [""] OR c.gender IN $gender)
      AND ($race IS NULL OR $race = [""] OR c.race IN $race)
      AND ($ethnicity IS NULL OR $ethnicity = [""] OR c.ethnicity IN $ethnicity)
      AND ($disease IS NULL OR $disease = [""] OR c.disease IN $disease)
      AND ($file_type IS NULL OR $file_type = [""] OR f.file_type IN $file_type)
      AND ($file_format IS NULL OR $file_format = [""] OR f.file_format IN $file_format)
    RETURN{
      group: a.arm_id+'_'+ a.arm_drug,
      count: COUNT(DISTINCT c)
    }
  """, passThrough: true)

# ---File Overview---
  
  fileOverview(
    uuid: [String] = [""],
    order_by: String = "file_name"
  ): [FileOverview] @cypher(statement: """
    MATCH (f:file)
      WHERE ($uuid IS NULL OR $uuid = [""] OR f.uuid IN $uuid)
    OPTIONAL MATCH (f)-[*]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    OPTIONAL MATCH (f)-[*]->(c:case)
    WITH
      f.uuid as file_uuid,
      f.file_name AS file_name,
      f.file_description AS file_description,
      f.file_format AS file_format,
      f.file_size AS file_size,
      ct.clinical_trial_short_name AS trial,
      ct.clinical_trial_id AS trial_id,
      ct.clinical_trial_designation AS clinical_trial_code,
      a.arm_id AS arm,
      c.case_id AS case_id,
      c.disease AS disease
    RETURN{
      uuid: file_uuid,
      file_name: file_name,
      file_description: file_description,
      file_format: file_format,
      file_size: file_size,
      trial: trial,
      trial_id: trial_id,
      clinical_trial_code: clinical_trial_code,
      arm: arm,
      case_id: case_id,
      disease: disease
    }
    ORDER BY 
      CASE $order_by
        WHEN "file_uuid" THEN file_uuid
        WHEN "file_name" THEN file_name
        WHEN "file_description" THEN file_description
        WHEN "file_format" THEN file_format
        WHEN "file_size" THEN file_size
        WHEN "trial" THEN trial
        WHEN "trial_id" THEN trial_id
        WHEN "arm" THEN arm
        WHEN "case_id" THEN case_id
        WHEN "disease" THEN disease
        WHEN "clinical_trial_code" THEN clinical_trial_code
        ELSE file_name
      END
  """, passThrough: true)

  fileOverviewDesc(
    uuid: [String] = [""],
    order_by: String = "file_name"
  ): [FileOverview] @cypher(statement: """
    MATCH (f:file)
      WHERE ($uuid IS NULL OR $uuid = [""] OR f.uuid IN $uuid)
    OPTIONAL MATCH (f)-[*]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    OPTIONAL MATCH (f)-[*]->(c:case)
    WITH
      f.uuid as file_uuid,
      f.file_name AS file_name,
      f.file_description AS file_description,
      f.file_format AS file_format,
      f.file_size AS file_size,
      ct.clinical_trial_short_name AS trial,
      ct.clinical_trial_id AS trial_id,
      ct.clinical_trial_designation AS clinical_trial_code,
      a.arm_id AS arm,
      c.case_id AS case_id,
      c.disease AS disease
    RETURN{
      uuid: file_uuid,
      file_name: file_name,
      file_description: file_description,
      file_format: file_format,
      file_size: file_size,
      trial: trial,
      trial_id: trial_id,
      clinical_trial_code: clinical_trial_code,
      arm: arm,
      case_id: case_id,
      disease: disease
    }
    ORDER BY 
      CASE $order_by
        WHEN "file_uuid" THEN file_uuid
        WHEN "file_name" THEN file_name
        WHEN "file_description" THEN file_description
        WHEN "file_format" THEN file_format
        WHEN "file_size" THEN file_size
        WHEN "trial" THEN trial
        WHEN "trial_id" THEN trial_id
        WHEN "arm" THEN arm
        WHEN "case_id" THEN case_id
        WHEN "disease" THEN disease
        WHEN "clinical_trial_code" THEN clinical_trial_code
        ELSE file_name
      END DESC
  """, passThrough: true)

  caseDetailByCaseId(case_id: String!): CaseDetail @cypher(statement: """
    MATCH (c:case)
      WHERE c.case_id = $case_id
    OPTIONAL MATCH (f:file)-[*]->(c)-[:of_arm]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    RETURN{
      case_id: c.case_id,
      clinical_trial_code: ct.clinical_trial_designation,
      clinical_trial_id: ct.clinical_trial_id,
      disease: c.disease,
      gender: c.gender,
      race: c.race,
      arm_id: a.arm_id,
      arm_target: a.arm_target,
      arm_drug: a.arm_drug,
      ethnicity: c.ethnicity,
      files: COLLECT(DISTINCT f.uuid)
    }
  """, passThrough: true)

  filesOfCase(case_id: String!): [FileOfCase] @cypher(statement: """
    MATCH (f:file)-[*]->(c:case)
    WITH 
      DISTINCT(f) AS f, 
      c 
    MATCH (f)-->(parent) 
      WHERE c.case_id = $case_id 
    RETURN{
      parent: head(labels(parent)),
      file_name: f.file_name,
      file_type: f.file_type,
      file_description: f.file_description,
      file_format: f.file_format,
      file_size: f.file_size,
      md5sum: f.md5sum
    }
  """, passThrough: true)

  filesInList(
    uuid: [String] = [""], 
    order_by: String = "uuid"
  ): [FileInList] @cypher(statement: """
    MATCH (f:file)
    OPTIONAL MATCH (f)-[*]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    OPTIONAL MATCH (f)-[*]->(c:case)
    WITH 
      DISTINCT(f) AS f, 
      c, ct, a
    MATCH (f)-->(parent) 
      WHERE f.uuid IN $uuid 
    WITH
      ct.clinical_trial_designation as clinical_trial_code,
      c.case_id as case_id,
      a.arm_id as arm_id,
      f.file_type as file_type,
      head(labels(parent)) as association,
      f.file_description as file_description,
      f.file_format as file_format,
      f.file_size as file_size,
      f.uuid as uuid,
      f.md5sum as md5sum,
      f.file_name as file_name
    RETURN{
      clinical_trial_code: clinical_trial_code,
      case_id: case_id, 
      arm_id: arm_id,
      file_type: file_type, 
      association: association,
      file_description: file_description,
      file_format: file_format,
      file_size: file_size,
      uuid: uuid,
      md5sum: md5sum,
      file_name: file_name
    }
    ORDER BY 
    CASE $order_by
      WHEN "uuid" THEN uuid
      WHEN "clinical_trial_code" THEN clinical_trial_code
      WHEN "case_id" THEN case_id
      WHEN "arm_id" THEN arm_id
      WHEN "file_type" THEN file_type
      WHEN "association" THEN association
      WHEN "file_description" THEN file_description
      WHEN "file_format" THEN file_format
      WHEN "file_size" THEN file_size
      WHEN "md5sum" THEN md5sum
      WHEN "file_name" THEN file_name
      ELSE uuid
    END
  """, passThrough: true)

  filesInListDesc(
    uuid: [String] = [""], 
    order_by: String = "uuid"
  ): [FileInList] @cypher(statement: """
    MATCH (f:file)
    OPTIONAL MATCH (f)-[*]->(a:arm)-[:of_trial]->(ct:clinical_trial)
    OPTIONAL MATCH (f)-[*]->(c:case)
    WITH 
      DISTINCT(f) AS f, 
      c, ct, a
    MATCH (f)-->(parent) 
      WHERE f.uuid IN $uuid 
        WITH
      ct.clinical_trial_designation as clinical_trial_code,
      c.case_id as case_id,
      a.arm_id as arm_id,
      f.file_type as file_type,
      head(labels(parent)) as association,
      f.file_description as file_description,
      f.file_format as file_format,
      f.file_size as file_size,
      f.uuid as uuid,
      f.md5sum as md5sum,
      f.file_name as file_name
    RETURN{
      clinical_trial_code: clinical_trial_code,
      case_id: case_id, 
      arm_id: arm_id,
      file_type: file_type, 
      association: association,
      file_description: file_description,
      file_format: file_format,
      file_size: file_size,
      uuid: uuid,
      md5sum: md5sum,
      file_name: file_name
    }
    ORDER BY 
    CASE $order_by
      WHEN "uuid" THEN uuid
      WHEN "clinical_trial_code" THEN clinical_trial_code
      WHEN "case_id" THEN case_id
      WHEN "arm_id" THEN arm_id
      WHEN "file_type" THEN file_type
      WHEN "association" THEN association
      WHEN "file_description" THEN file_description
      WHEN "file_format" THEN file_format
      WHEN "file_size" THEN file_size
      WHEN "md5sum" THEN md5sum
      WHEN "file_name" THEN file_name
      ELSE uuid
    END DESC
  """, passThrough: true)

  diagnosisCountByArm: [ArmDiagnosisCount] @cypher(statement: """
    MATCH (a:arm)
    OPTIONAL MATCH (c:case)-[:of_arm]->(a)
    RETURN{
      arm_id: a.arm_id,
      diagnoses: COUNT(DISTINCT c.disease)
    }
  """, passThrough: true)

  clinicalTrials: [ClinicalTrialInfo] @cypher(statement: """
    MATCH (ct:clinical_trial)
    OPTIONAL MATCH (c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct)
    RETURN{
      clinical_trial_id: ct.clinical_trial_id,
      clinical_trial_short_name: ct.clinical_trial_short_name,
      clinical_trial_description: ct.clinical_trial_description,
      clinical_trial_designation: ct.clinical_trial_designation,
      clinical_trial_long_name: ct.clinical_trial_long_name,
      clinical_trial_type: ct.clinical_trial_type,
      lead_organization: ct.lead_organization,
      principal_investigators: ct.principal_investigators,
      number_of_arms: COUNT(DISTINCT a),
      number_of_cases: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  clinicalTrialByTrialId(trial_id: String!): ClinicalTrialInfo @cypher(statement: """
    MATCH (ct:clinical_trial)
      WHERE ct.clinical_trial_id = $trial_id
    OPTIONAL MATCH (c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct)
    RETURN{
      clinical_trial_id: ct.clinical_trial_id,
      clinical_trial_short_name: ct.clinical_trial_short_name,
      clinical_trial_description: ct.clinical_trial_description,
      clinical_trial_designation: ct.clinical_trial_designation,
      clinical_trial_long_name: ct.clinical_trial_long_name,
      clinical_trial_type: ct.clinical_trial_type,
      lead_organization: ct.lead_organization,
      principal_investigators: ct.principal_investigators,
      number_of_arms: COUNT(DISTINCT a),
      number_of_cases: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  fileCountByTrialId(trial_id: String!): Int @cypher(statement: """
    MATCH (ct:clinical_trial)
      WHERE ct.clinical_trial_id = $trial_id
    OPTIONAL MATCH (f:file)-[*]->(ct)
    RETURN COUNT(DISTINCT f)
  """)

  clinicalTrialArmByTrialId(trial_id: String!): [ClinicalTrialArm] @cypher(statement: """
    MATCH (ct:clinical_trial)
      WHERE ct.clinical_trial_id = $trial_id
    OPTIONAL MATCH (c:case)-[:of_arm]->(a:arm)-[:of_trial]->(ct)
    RETURN{
      arm_id: a.arm_id,
      arm_target: a.arm_target,
      arm_drug: a.arm_drug,
      pubmed_id: a.pubmed_id,
      number_of_cases: COUNT(DISTINCT c)
    }
  """, passThrough: true)

  fileIdsFromFileName(file_name: [String] = [""], order_by: String = ""): [FileNameAndId] @cypher(statement: """
    MATCH (f:file)
      WHERE $file_name IS NULL OR $file_name = [""] OR f.file_name IN $file_name
    RETURN{
      file_name: f.file_name,
      file_id: f.uuid
    }
    ORDER BY
    CASE $order_by
      WHEN 'file_id' THEN f.uuid
      ELSE f.file_name
    END
  """, passThrough: true) 

  fileIdsFromFileNameDesc(file_name: [String] = [""], order_by: String = ""): [FileNameAndId] @cypher(statement: """
    MATCH (f:file)
      WHERE $file_name IS NULL OR $file_name = [""] OR f.file_name IN $file_name
    RETURN{
      file_name: f.file_name,
      file_id: f.uuid
    }
    ORDER BY
    CASE $order_by
      WHEN 'file_id' THEN f.uuid
      ELSE f.file_name
    END DESC
  """, passThrough: true) 

} 